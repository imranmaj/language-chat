$(function(){const e="p",o=$("#messageBox").attr("placeholder");var s=io();function t(){$("html, body").scrollTop($(document).height()-$(window).height())}function n(){$("#messageBox").focus()}function i(o){return $(`<${e}>`).append($("<b>").text(`${o.username} (${o.timestamp}): `)).append(o.content)}$.fn.isInViewport=function(){var e=$(this).offset().top,o=e+$(this).outerHeight(),s=$(window).scrollTop(),t=s+$(window).height();return o>s&&e<t},s.on("receive-new-message",function(e){$("#messages").append(i(e)),t()}),s.on("receive-previous-message",function(e){$("#messages").prepend(i(e)),e.scroll&&$(window).trigger("scroll")}),$(window).scroll(function(){0===$(window).scrollTop()?s.emit("load-previous-message",{scroll:!0}):$(e).filter(":lt(20)").is(function(e,o){return $(o).isInViewport()})&&s.emit("load-previous-message",{scroll:!1})}),$("form").submit(function(e){return e.preventDefault(),""!=$.trim($("#messageBox").val())&&s.emit("send-message",$("#messageBox").val()),$("#messageBox").val(""),n(),!1}),$(window).keypress(function(){n()}),$("#messageBox").focus(function(){$(this).attr("placeholder",o)}),$("#messageBox").blur(function(){$(this).attr("placeholder","Press any key to start typing")}),s.emit("connect"),t(),n()});